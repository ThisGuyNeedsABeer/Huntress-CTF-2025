Challenge: Bussing Around
Category: Forensics
Author: @Soups71

Description:

One of the engineers noticed that an HMI was going haywire.
He took a packet capture of some of the traffic but he can't make any sense of it... it just looks like gibberish!
For some reason, some of the traffic seems to be coming from someone's computer. Can you help us figure out what's going on?

bussing_around.pcapng 1.83 MB

Solve:

1. Download and analyze the pcap in Wireshark.
	
	a. There seems to be an excessive amount of "modbus/TCP" traffic which makes sense given the challenge description.

2. After reading up on how these controllers work, I found that there are specific unit identifiers

	a. Unit ID 3 might be the main PLC (like “Tank Controller”)
	b. Unit ID 6 might be another sub-module
	c. Unit ID 38 might be a remote I/O device or an intentionally planted “fake” device

3. I isolated the register values for Unit ID 38 with the following filter:

	a. modbus.func_code == 6 && modbus && mbtcp.unit_id == 38  && modbus.regval_uint16

4. Adding the "Register Value (UINT 16)" to my column list in Wireshark, we can see what might be a binary pattern (wireshark-1.png)

5. Extracting this data and pasting into Cyberchef, we can see our hypothesis was confirmed. [cyberchef-1.png]

01010000010010110000001100000100000010100000000000001001000000000000000000000000100010110101011000111010010110111010111101010100011010001011010100110011000000000000000000000000001001110000000000000000000000000000100000000000000111000000000001100110011011000110000101100111001011100111010001111000011101000101010101010100000010010000000000000011101001011010100011010110011010001110011010101000110101100110100001110101011110000000101100000000000000010000010011101000000000110000000000000000000001001110100000000011000000000000000011000111011111010111111110011000101000100001101000010010001110000010101011000011101000001010110101000001001110001011000101110110110110111110100001010101101010101100011011110010101001101111110001001000001001010001111110001100111101000001101011001101010100011011010000100110000001011111101001010001010011101111011110110011001110000110100000000110111110011100010100110001100011011111110000101011110000111101000101010000010010110000011100001000101011110101010001101000101101010011001100000000000000000000000000100111000000000000000000000000010100000100101100000001000000100001111000000011000010100000000000001001000000000000000000000000100010110101011000111010010110111010111101010100011010001011010100110011000000000000000000000000001001110000000000000000000000000000100000000000000110000000000000000000000000000000000000000000000000010000000000000000000000001011010010000001000000000000000000000000000000000110011001101100011000010110011100101110011101000111100001110100010101010101010000000101000000000000001110100101101010001101011001101000011101010111100000001011000000000000000100000100111010000000001100000000000000000000010011101000000000110000000000000000010100000100101100000101000001100000000000000000000000000000000000000001000000000000000100000000010011100000000000000000000000001000010100000000000000000000000000110010000000000101010001101000011001010010000001110000011000010111001101110011011101110110111101110010011001000010000001101001011100110010000000110101001110010011001100111001011001100011001101100101011000110011100101100100001110000011001000110000011001100011001000110011011001000110011000110010001100000011100100110100001110000110000101100110001100000011100101100001001101010011011000111000001100100010000000101110

	a. We can see a "PK" header which tells us this is probably an archive
	b. We see "flag.txt"
	c. We see "The password is 5939f3ec9d820f23df20948af09a5682"

6. Adding an "Unzip" function and the password into Cyberchef we can extract "flag.txt" and capture our flag.

Flag: flag{4d2a66c5ed8bb8cd4e4e1ab32c71f7a3}

