Challenge: Sandy
Category: Malware
Author: John Hammond

Description:

My friend Sandy is really into cryptocurrencies! She's been trying to get me into it too, so she showed me a lot of Chrome extensions I could add to manage my wallets. Once I got everything sent up, she gave me this cool program!

She says it adds better protection so my wallets can't get messed with by hackers.

Sandy wouldn't lie to me, would she...? Sandy is the best!

CAUTION

This is the Malware category, and as such, includes malware. Please be sure to analyze these files within an isolated virtual machine.

The password to the archive is infected.

Solve:

1. Download the SANDY.zip challenge file and extract

┌──(ctf㉿kali)-[~/CTF/huntress2025/malware/sandy]
└─$ 7z x -pinfected SANDY.zip

7-Zip 25.01 (x64) : Copyright (c) 1999-2025 Igor Pavlov : 2025-08-03
 64-bit locale=en_US.UTF-8 Threads:16 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 336944 bytes (330 KiB)

Extracting archive: SANDY.zip
--
Path = SANDY.zip
Type = zip
Physical Size = 336944

Everything is Ok

Size:       342592
Compressed: 336944

┌──(ctf㉿kali)-[~/CTF/huntress2025/malware/sandy]
└─$ file SANDY.exe               
SANDY.exe: PE32 executable for MS Windows 4.00 (GUI), Intel i386, UPX compressed, 3 sections

2. Unpack the binary with UPX

┌──(ctf㉿kali)-[~/CTF/huntress2025/malware/sandy]
└─$ upx -d SANDY.exe           
                       Ultimate Packer for eXecutables
                          Copyright (C) 1996 - 2024
UPX 4.2.4       Markus Oberhumer, Laszlo Molnar & John Reiser    May 9th 2024

        File size         Ratio      Format      Name
   --------------------   ------   -----------   -----------
    567872 <-    342592   60.33%    win32/pe     SANDY.exe

Unpacked 1 file.

3. Extract the auto-it code back to it's native .au3 format with: https://github.com/digitalsleuth/autoit-extractor
4. Sanitize and decode the $base64Chunks[]

https://gchq.github.io/CyberChef/#recipe=Find_/_Replace(%7B'option':'Regex','string':'%22'%7D,'',true,false,true,false)Find_/_Replace(%7B'option':'Regex','string':'%26%20_'%7D,'',true,false,true,false)Find_/_Replace(%7B'option':'Simple%20string','string':'%20%20%20%20'%7D,'',true,false,true,false)From_Base64('A-Za-z0-9%2B/%3D',true,false)&ieol=CRLF

5. Save the output from CyberChef (download.dat)
6. Open in a text editor to review
7. Change all "Invoke-Expression" to "Write-Host" to review the decoded payloads
8. All are "$encodedScript" blocks except one which is "$encodedJson"
9. Decode the JSON block

┌──(ctf㉿kali)-[~/CTF/huntress2025/malware/sandy]
└─$ pwsh decode_json.ps1 

---- OUTPUT SNIPPED ----

             {
                "name": "Flag",
                "path": "flag{27768419fd176648b335aa92b8d2dab2}"
             }
---- OUTPUT SNIPPED ----

Flag: flag{27768419fd176648b335aa92b8d2dab2}